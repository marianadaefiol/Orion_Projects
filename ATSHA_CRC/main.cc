#include <stdio.h>
#include <stdint.h>
#include <unistd.h>
#include <iostream>

void atCRC(size_t length, const uint8_t *data, uint8_t *crc_le)
{
    size_t counter;
    uint16_t crc_register = 0;
    uint16_t polynom = 0x8005;
    uint8_t shift_register;
    uint8_t data_bit, crc_bit;

    for (counter = 0; counter < length; counter++)
    {
        for (shift_register = 0x01; shift_register > 0x00; shift_register <<= 1)
        {
            data_bit = (data[counter] & shift_register) ? 1 : 0;
            crc_bit = crc_register >> 15;
            crc_register <<= 1;
            if (data_bit != crc_bit)
            {
                crc_register ^= polynom;
            }
        }
    }
    crc_le[0] = (uint8_t)(crc_register & 0x00FF);
    crc_le[1] = (uint8_t)(crc_register >> 8);
}

int main(int argc, char *argv[])
{
  std::cout << "" << std::endl;
/*
const uint8_t data[] = { 0x1,
0x23,
0xbc,
0x62,
0x0, 
0x9,
0x4,
0x0,
0x65,
0xcf,
0x66,	
0xd4,
0xee,	
0x9,	
0x1,	
0x0,	
0xc8,	
0x00,	
0x55,	
0x0	,
0xe9,	
0x60,	
0xe8,	
0x70,	
0xe1,	
0x40,	
0xa1,	
0x80,	
0xc1,	
0x75,	
0xa0,	
0x60,	
0xd1,	
0x47,	
0xb0,	
0x40,	
0xce,	
0x49,	
0xce,	
0x49,	
0xc8,	
0x49,	
0x88,	
0x89,	
0xd8,	
0x4d,	
0x90,	
0x49,	
0xe	,
0xe	,
0x88,	
0x49,	
0xff,	
0x0	,
0xff,	
0x0	,
0xff,	
0x0	,
0xff,	
0x0	,
0xff,	
0x0	,
0xff,	
0x00,	
0xff,	
0x0	,
0xff,	
0x00,
0xff,	
0xff,	
0xff,	
0xff,
0xff,	
0xff,	
0xff,	
0xff,	
0xff,	
0xff,	
0xff,	
0xff,
0xff,	
0xff,	
0xff,	
0xff,
0x0	,
0x0	,
0x55,	
0x00	}; 

*/ 

const uint8_t data[] = {0x07, 0x02, 0x82, 0x08, 0x00}; 
  uint8_t crc[] = {0x00, 0x00};
  printf("crc: 0x%02x 0x%02x\n", crc[0], crc[1]);
  atCRC(sizeof(data), data, crc);
  printf("crc: 0x%02x 0x%02x\n", crc[0], crc[1]);

  return(0);
}
